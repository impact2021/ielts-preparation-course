# Version 13.5 Release Notes

## Critical Bug Fix: "Show me" Buttons Not Appearing

**Date:** 2026-01-23

### Problem Statement
A major issue was discovered where the "Show me" buttons were not appearing for correct or incorrect answers - they only showed when no answer was given. This severely impacted the learning experience as students couldn't see where answers were located in reading passages or listening transcripts after answering questions correctly or incorrectly.

### Root Cause Analysis

The issue was in the JavaScript file `assets/js/frontend.js`. The code had conditions that only created feedback div elements when `questionResult.feedback` was truthy (lines 1013 and 1024 in the original code):

```javascript
// OLD CODE - BROKEN
if (questionResult.feedback) {
    // Create feedback div and display "Show me" buttons
}
```

**The Problem:**
1. When a question had a correct/incorrect answer without custom feedback text in the option, the feedback was an empty string `''`
2. Empty string evaluates to `false` in JavaScript
3. The feedback div was never created
4. Without the feedback div, "Show me" buttons had nowhere to be attached
5. The buttons would be lost even though they were generated by the PHP backend

**Why It Only Worked for "No Answer":**
- The "no answer" case typically had `no_answer_feedback` set in the question JSON
- This meant `questionResult.feedback` would contain text like "The correct answer is..."
- Non-empty string evaluates to `true`, so the feedback div WAS created
- The "Show me" button would be displayed

### The Fix

Modified the JavaScript to create feedback divs whenever there's feedback text OR when "Show me" buttons need to be displayed:

```javascript
// NEW CODE - FIXED
// Helper function to check if question has "Show me" button capability
function questionHasShowMeButton(questionResult) {
    return (questionResult.audio_section_id !== null && questionResult.audio_section_id !== undefined) ||
           (questionResult.reading_text_id !== null && questionResult.reading_text_id !== undefined);
}

// Create feedback div if there's feedback OR "Show me" buttons
if (questionResult.feedback || questionHasShowMeButton(questionResult)) {
    // Create feedback div and display content
}
```

### Files Modified

1. **assets/js/frontend.js**
   - Added `questionHasShowMeButton()` helper function (lines 320-324)
   - Changed condition for dropdown_paragraph questions (line 1020)
   - Changed condition for other question types (line 1034)
   - Updated `.html(questionResult.feedback)` to `.html(questionResult.feedback || '')` to handle empty feedback gracefully
   - Fixed outdated comment reference

2. **ielts-course-manager.php**
   - Updated version from 13.4 to 13.5

### Testing Recommendations

To verify the fix works correctly, test with exercises that have:

1. **Correct answers without custom feedback:**
   - Answer a question correctly
   - Verify the "Show me" button appears
   - Click it and verify highlighting works

2. **Incorrect answers without custom feedback:**
   - Answer a question incorrectly
   - Verify the "Show me" button appears
   - Click it and verify highlighting works

3. **No answer given:**
   - Leave a question unanswered and submit
   - Verify the "Show me" button still appears (regression test)
   - Click it and verify highlighting works

4. **Questions with custom feedback:**
   - Test with questions that have feedback text in options
   - Verify "Show me" buttons appear alongside the feedback
   - Verify both feedback text and buttons display correctly

### Impact

**Before Fix:**
- ❌ "Show me" buttons missing for correct answers without custom feedback
- ❌ "Show me" buttons missing for incorrect answers without custom feedback
- ✅ "Show me" buttons working for unanswered questions (had no_answer_feedback)

**After Fix:**
- ✅ "Show me" buttons appear for ALL answer states (correct/incorrect/no answer)
- ✅ Buttons display consistently across all question types
- ✅ Works for both reading tests (reading_text_id) and listening tests (audio_section_id)

### Code Quality Improvements

During the code review process, we also:
1. Extracted duplicate logic into a reusable helper function (`questionHasShowMeButton`)
2. Updated outdated code comments
3. Improved code maintainability and readability

### Security

CodeQL analysis confirmed no security vulnerabilities were introduced by these changes.

---

**Version:** 13.5  
**Previous Version:** 13.4  
**Type:** Critical Bug Fix  
**Breaking Changes:** None
