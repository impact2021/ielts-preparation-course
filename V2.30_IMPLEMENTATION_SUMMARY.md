# Version 2.30 Implementation Summary

## Overview
This update introduces version 2.30 of the IELTS Course Manager plugin with two main features:
1. Course cloning functionality
2. Question type renaming for statistical purposes

## Changes Made

### 1. Version Update
- Updated plugin version from 2.29 to 2.30
- Modified `ielts-course-manager.php`:
  - Version header: `2.30`
  - IELTS_CM_VERSION constant: `2.30`

### 2. Question Type Renaming
The existing "Classifying and Matching Questions" type was renamed to maintain consistency while keeping it separate from multiple choice for statistical tracking.

**Files Modified:**
- `includes/class-quiz-handler.php`
  - Renamed `classifying_matching` to `matching_classifying` in `get_quiz_types()`
  - Updated `check_answer()` method to handle the new type name
  - Functionality remains identical to multiple choice (radio button selection)

- `includes/admin/class-admin.php`
  - Updated JavaScript to recognize `matching_classifying` type
  - Modified PHP conditional checks for showing/hiding appropriate fields
  - Ensures correct admin interface behavior

- `templates/single-quiz.php`
  - Updated case statement to use `matching_classifying`
  - Updated comments referencing the type

- `templates/single-quiz-computer-based.php`
  - Updated case statement to use `matching_classifying`
  - Updated comments referencing the type

**Behavior:**
- Works exactly like multiple choice questions
- Uses radio button selection interface
- Scores 1 point per question
- Kept separate for statistical analysis purposes

### 3. Course Cloning Feature
Implemented comprehensive course cloning functionality that duplicates courses with all their content.

#### Backend Implementation

**`includes/admin/class-admin.php`:**

1. **Meta Box Addition:**
   - Added `clone_course_meta_box()` method
   - Displays clone button in sidebar of course edit pages
   - Only shows for existing (saved) courses
   - Includes status message area

2. **AJAX Handler:**
   - Added `ajax_clone_course()` method
   - Validates nonce and user permissions
   - Orchestrates the cloning process
   - Returns success/error response with edit link

3. **Clone Helper:**
   - Added `clone_post()` private method
   - Duplicates posts with all meta data
   - Preserves taxonomies
   - Handles serialized data correctly
   - Skips relationship meta that will be set separately

4. **Cloning Process:**
   - Clones the course (set to draft with "(Copy)" suffix)
   - Retrieves all associated lessons
   - Clones each lesson and updates course association
   - Clones all sub-lessons (resources) and updates lesson association
   - Clones all exercises/quizzes and updates lesson association
   - Maintains proper parent-child relationships in the clone

**`includes/class-ielts-course-manager.php`:**
- Added `courseMetaNonce` to localized script data
- Provides security token for AJAX requests

#### Frontend Implementation

**`assets/js/admin.js`:**
- Added click handler for clone button
- Shows confirmation dialog before cloning
- Disables button during cloning operation
- Makes AJAX request to clone the course
- Displays success message with link to edit cloned course
- Shows error messages if cloning fails
- Re-enables button after completion

**`assets/css/admin.css`:**
- Added styles for success status messages (green)
- Added styles for error status messages (red)
- Styled links in status messages

### 4. Documentation
Updated `CHANGELOG.md` with:
- New version 2.30 section
- Course cloning feature details
- Question type renaming details
- Version update note

## Technical Details

### Clone Functionality Flow
1. User clicks "Clone Course" button
2. JavaScript confirms action with user
3. AJAX request sent with course ID and nonce
4. Server validates permissions and course exists
5. Course is cloned (draft status, title with "(Copy)")
6. All course meta is duplicated
7. System retrieves all lessons for the course
8. Each lesson is cloned:
   - Lesson post duplicated
   - Lesson meta duplicated
   - Course association updated to new course
   - Sub-lessons cloned and linked to new lesson
   - Exercises cloned and linked to new lesson
9. Success response sent with new course details
10. User receives confirmation with edit link

### Data Preservation
The cloning process preserves:
- Post title, content, excerpt
- Post meta data (settings, configurations)
- Taxonomies (course categories)
- Menu order
- All question data in quizzes
- Reading texts in exercises
- Course structure and hierarchy

### Security
- AJAX nonce verification
- User capability checks (`edit_posts`)
- Input sanitization
- Post type validation

## Files Modified
1. `ielts-course-manager.php` - Version update
2. `includes/class-quiz-handler.php` - Question type rename
3. `includes/admin/class-admin.php` - Clone functionality and question type updates
4. `includes/class-ielts-course-manager.php` - Nonce addition
5. `templates/single-quiz.php` - Question type rename
6. `templates/single-quiz-computer-based.php` - Question type rename
7. `assets/js/admin.js` - Clone button handler
8. `assets/css/admin.css` - Clone status styling
9. `CHANGELOG.md` - Version documentation

## Testing Recommendations

### Question Type Testing
1. Create a quiz with "Matching and classifying questions" type
2. Verify it displays with radio buttons like multiple choice
3. Submit answers and verify correct scoring
4. Check both standard and computer-based quiz layouts
5. Verify question type appears in admin dropdown

### Course Cloning Testing
1. Create a test course with lessons, sub-lessons, and exercises
2. Navigate to course edit page
3. Verify "Clone Course" button appears in sidebar
4. Click clone button and confirm dialog
5. Wait for success message
6. Click link to edit cloned course
7. Verify all content is duplicated:
   - Course settings and meta
   - All lessons in correct order
   - All sub-lessons linked correctly
   - All exercises with questions intact
   - Course categories preserved
8. Verify original course is unchanged
9. Test with empty course (no lessons)
10. Test with complex nested structure

### Edge Cases
1. Clone course with no content
2. Clone course with large number of lessons
3. Verify permissions (non-admin users)
4. Test with network/timeout scenarios

## Backward Compatibility
- All existing `classifying_matching` questions will continue to work
- Database contains old type name, system processes both
- No data migration required
- Cloning is new feature, doesn't affect existing functionality

## Performance Considerations
- Cloning large courses may take several seconds
- Button disabled during operation to prevent double-clicks
- AJAX timeout should be considered for very large courses
- Consider adding progress indicator for large courses in future

## Future Enhancements
1. Add progress bar for cloning large courses
2. Option to clone only specific lessons
3. Batch clone multiple courses
4. Clone course to different site (multi-site)
5. Preview cloned content before finalizing
